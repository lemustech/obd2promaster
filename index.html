<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OBD2 Ultimate by Lemustech</title>
    <meta name="description" content="Base de datos de códigos OBD2 profesional para mecánicos. Soluciones, causas y diagnósticos P, U, B, C.">
    <!-- Favicon -->
    <link rel="icon" type="image/jpeg" href="https://i.postimg.cc/52KNxN9H/generated-image-(3).jpg">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        slate: {
                            850: '#151e2e', 900: '#0f172a', 950: '#020617',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Base Variables */
        :root {
            --bg-body: #f1f5f9;
            --text-main: #0f172a;
            --card-bg: rgba(255, 255, 255, 0.8);
            --card-border: rgba(0, 0, 0, 0.1);
        }

        .dark {
            --bg-body: #0f172a;
            --text-main: #e2e8f0;
            --card-bg: rgba(30, 41, 59, 0.7);
            --card-border: rgba(255, 255, 255, 0.08);
        }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            transition: background-color 0.3s, color 0.3s;
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(59, 130, 246, 0.05) 0%, transparent 25%), 
                radial-gradient(circle at 85% 30%, rgba(16, 185, 129, 0.05) 0%, transparent 25%);
            background-attachment: fixed;
            min-height: 100vh;
        }
        
        .glass-panel {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--card-border);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }

        /* Category Buttons */
        .category-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .category-btn:hover {
            transform: translateY(-2px);
        }
        .category-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        /* Card Animations */
        .code-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: center;
        }
        .code-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 30px -5px rgba(0, 0, 0, 0.15);
            z-index: 10;
        }

        .anim-entry {
            animation: fadeInScale 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            opacity: 0;
            transform: scale(0.98);
        }
        @keyframes fadeInScale {
            to { opacity: 1; transform: scale(1); }
        }

        /* View Modes (Responsive Update) */
        .view-compact .code-card {
            display: flex;
            flex-direction: column; /* Por defecto vertical en móvil */
            padding: 1rem;
            min-height: auto;
            gap: 0.5rem;
        }
        .view-compact .card-details, .view-compact .card-actions { display: none; }
        
        /* Solo en pantallas grandes (sm+) se pone horizontal */
        @media (min-width: 640px) {
            .view-compact .code-card {
                flex-direction: row;
                align-items: center;
                gap: 0;
            }
            .view-compact .card-header { padding: 0; border: none; background: transparent; width: auto; margin-right: 1.5rem; margin-bottom: 0; }
            .view-compact .card-body { padding: 0; display: flex; align-items: center; justify-content: space-between; width: 100%; }
            .view-compact .card-title-lg { font-size: 1.5rem; }
            .view-compact .card-desc { margin-bottom: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 300px; }
        }

        /* Print Styles */
        @media print {
            body { background: white; color: black; }
            header, .filters-bar, footer, #historyPanel, .no-print { display: none !important; }
            .glass-panel { border: 1px solid #ccc; background: white; box-shadow: none; break-inside: avoid; page-break-inside: avoid; color: black !important; }
            .code-card { box-shadow: none; transform: none !important; }
            .text-slate-300, .text-slate-400 { color: #333 !important; }
            .text-white { color: black !important; }
            a { text-decoration: underline; color: blue; }
        }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #64748b; border-radius: 4px; }
    </style>
</head>
<body class="flex flex-col font-sans selection:bg-blue-500/30">

    <!-- Header -->
    <header class="bg-white/80 dark:bg-slate-900/90 backdrop-blur-xl border-b border-gray-200 dark:border-slate-700/50 sticky top-0 z-50 shadow-lg print:hidden">
        <div class="container mx-auto px-4 py-3">
            <div class="flex flex-col lg:flex-row justify-between items-center gap-4">
                
                <!-- Logo & Title -->
                <div class="flex items-center gap-4 group cursor-pointer" onclick="window.location.reload()">
                    <div class="relative">
                        <div class="absolute inset-0 bg-blue-500 rounded-xl blur opacity-20 group-hover:opacity-40 transition-opacity"></div>
                        <!-- LOGO REEMPLAZADO -->
                        <img src="https://i.postimg.cc/52KNxN9H/generated-image-(3).jpg" alt="Lemustech Logo" class="w-12 h-12 rounded-xl relative border border-gray-200 dark:border-slate-700 shadow-sm object-cover">
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-slate-800 dark:text-white tracking-tight">OBD2 <span class="text-blue-600 dark:text-blue-400">Ultimate</span></h1>
                        <p class="text-[10px] text-slate-500 dark:text-slate-400 font-bold tracking-widest uppercase">by Lemustech</p>
                    </div>
                </div>
                
                <!-- Search & Actions -->
                <div class="flex items-center gap-3 w-full lg:w-auto">
                    <!-- Search Bar -->
                    <div class="relative flex-grow lg:w-[400px] group">
                        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                            <i class="fa-solid fa-magnifying-glass text-slate-400 group-focus-within:text-blue-500 transition-colors"></i>
                        </div>
                        <input type="text" id="searchInput" placeholder="Buscar código (P0300), síntoma..." 
                            class="block w-full pl-11 pr-12 py-2.5 bg-gray-100 dark:bg-slate-950/50 border border-gray-200 dark:border-slate-700 rounded-xl text-slate-800 dark:text-white placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all font-medium text-sm">
                        <button id="clearSearch" class="absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-red-500 hidden cursor-pointer">
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                    </div>

                    <!-- Toolbar -->
                    <div class="flex items-center gap-2 border-l border-gray-300 dark:border-slate-700 pl-3">
                        <button onclick="toggleTheme()" class="p-2.5 rounded-lg hover:bg-gray-200 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400 transition-colors" title="Cambiar Tema">
                            <i class="fa-solid fa-sun hidden dark:block"></i>
                            <i class="fa-solid fa-moon dark:hidden"></i>
                        </button>
                        <button onclick="toggleView()" class="p-2.5 rounded-lg hover:bg-gray-200 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400 transition-colors" title="Cambiar Vista">
                            <i class="fa-solid fa-list" id="viewIcon"></i>
                        </button>
                        <button onclick="toggleHistory()" class="p-2.5 rounded-lg hover:bg-gray-200 dark:hover:bg-slate-800 text-blue-600 dark:text-blue-400 transition-colors relative" title="Historial Reciente">
                            <i class="fa-solid fa-clock-rotate-left"></i>
                            <span id="historyBadge" class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full hidden"></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- History Panel (Hidden by default) -->
    <div id="historyPanel" class="hidden bg-gray-100 dark:bg-slate-900 border-b border-gray-200 dark:border-slate-800 py-4 shadow-inner anim-entry">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-sm font-bold text-slate-700 dark:text-slate-300 uppercase tracking-wide"><i class="fa-solid fa-clock-rotate-left mr-2"></i>Códigos Recientes</h3>
                <button onclick="clearHistory()" class="text-xs text-red-500 hover:text-red-400 font-medium hover:underline">Borrar Historial</button>
            </div>
            <div id="historyList" class="flex flex-wrap gap-2">
                <p class="text-sm text-slate-500 italic">No hay códigos recientes.</p>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8">
        
        <!-- Filters Bar -->
        <div class="filters-bar flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6 mb-8">
            <div class="flex flex-wrap gap-2" id="filterContainer">
                <button class="category-btn active px-4 py-2 rounded-lg border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 text-sm font-bold uppercase tracking-wide flex items-center gap-2 shadow-sm" data-filter="all">
                    Todos
                </button>
                <button class="category-btn px-4 py-2 rounded-lg border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 text-sm font-bold uppercase tracking-wide flex items-center gap-2 shadow-sm group" data-filter="P">
                    <i class="fa-solid fa-gauge-high text-orange-500 dark:text-orange-400"></i> Motor
                </button>
                <button class="category-btn px-4 py-2 rounded-lg border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 text-sm font-bold uppercase tracking-wide flex items-center gap-2 shadow-sm group" data-filter="B">
                    <i class="fa-solid fa-shield-halved text-green-600 dark:text-green-400"></i> Carrocería
                </button>
                <button class="category-btn px-4 py-2 rounded-lg border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 text-sm font-bold uppercase tracking-wide flex items-center gap-2 shadow-sm group" data-filter="C">
                    <i class="fa-solid fa-circle-notch text-purple-600 dark:text-purple-400"></i> Chasis
                </button>
                <button class="category-btn px-4 py-2 rounded-lg border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 text-sm font-bold uppercase tracking-wide flex items-center gap-2 shadow-sm group" data-filter="U">
                    <i class="fa-solid fa-network-wired text-yellow-600 dark:text-yellow-400"></i> Red
                </button>
            </div>
            
            <div class="flex items-center gap-4 text-sm text-slate-500 dark:text-slate-400 font-mono">
                <span>Resultados: <strong class="text-slate-800 dark:text-white" id="visibleCount">0</strong></span>
                <span class="h-4 w-[1px] bg-slate-300 dark:bg-slate-700"></span>
                <span>Total DB: <strong class="text-blue-600 dark:text-blue-400" id="totalCount">0</strong></span>
            </div>
        </div>

        <!-- Grid Container -->
        <div id="resultsContainer" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 pb-12 transition-all">
            <!-- Content injected via JS -->
        </div>
        
        <!-- Empty State -->
        <div id="noResults" class="hidden flex flex-col items-center justify-center py-24 text-center">
            <div class="w-20 h-20 bg-gray-200 dark:bg-slate-800 rounded-full flex items-center justify-center mb-6 text-slate-500">
                <i class="fa-solid fa-magnifying-glass-minus text-3xl"></i>
            </div>
            <h3 class="text-xl font-bold text-slate-800 dark:text-white mb-2">Sin coincidencias</h3>
            <p class="text-slate-500 text-sm max-w-md mx-auto mb-6">Intenta buscar solo el número (ej. "0300") o usa palabras clave generales.</p>
            <button onclick="resetSearch()" class="px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg font-medium transition-colors shadow-lg shadow-blue-500/20">
                Restablecer Filtros
            </button>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-white dark:bg-slate-950 border-t border-gray-200 dark:border-slate-800 py-8 mt-auto print:hidden">
        <div class="container mx-auto px-4 text-center">
            
            <!-- Instagram Link -->
            <div class="flex justify-center gap-4 mb-4">
                <a href="https://instagram.com/lemustech.net" target="_blank" class="flex items-center gap-2 px-4 py-2 bg-gradient-to-tr from-yellow-500 via-pink-500 to-purple-600 text-white rounded-full font-bold text-sm hover:opacity-90 transition-opacity">
                    <i class="fa-brands fa-instagram text-xl"></i> @lemustech.net
                </a>
            </div>

            <p class="text-slate-500 text-sm font-medium">OBD2 Ultimate by Lemustech</p>
            <p class="text-slate-400 text-xs mt-2 max-w-2xl mx-auto flex items-center justify-center gap-1">
                Creada con <i class="fa-solid fa-heart text-red-500 animate-pulse"></i> en Caracas, Venezuela
            </p>
            <p class="text-slate-600 dark:text-slate-500 text-[10px] mt-2">Herramienta de referencia técnica. Consulte manuales OEM.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script>
        // --- MOTOR DE CONOCIMIENTO TÉCNICO (KNOWLEDGE BASE) ---
        const knowledgeBase = {
            'P00': { 
                sys: 'Combustible y Aire (Aux)', symptoms: ['Check Engine', 'Pérdida potencia'],
                causes: ['Sensor defectuoso', 'Cableado abierto', 'Conector sucio'], solutions: ['Revisar conector', 'Medir resistencia', 'Cambiar sensor'] 
            },
            'P01': { 
                sys: 'Medición Combustible/Aire', symptoms: ['Humo negro', 'Consumo alto', 'Ralentí mal'],
                causes: ['Fugas vacío', 'MAF sucio', 'Sensor O2 mal'], solutions: ['Limpiar MAF', 'Buscar fugas', 'Cambiar O2']
            },
            'P02': { 
                sys: 'Sistema Inyección', symptoms: ['Tiembla motor', 'Olor gasolina', 'Humo'],
                causes: ['Inyector sucio', 'Bomba inyección', 'Cableado'], solutions: ['Limpiar inyectores', 'Balance de cilindros']
            },
            'P03': { 
                sys: 'Sistema Encendido', symptoms: ['Misfire fuerte', 'Check Engine parpadea'],
                causes: ['Bujías viejas', 'Bobina quemada', 'Compresión baja'], solutions: ['Cambiar bujías', 'Probar bobinas', 'Test compresión']
            },
            'P04': { 
                sys: 'Emisiones (EVAP/EGR)', symptoms: ['Olor huevo podrido', 'Fallo ITV'],
                causes: ['Catalizador mal', 'Tapón gasolina flojo', 'EGR sucia'], solutions: ['Revisar tapón', 'Limpiar EGR', 'Verificar fugas']
            },
            'P05': { 
                sys: 'Velocidad y Ralentí', symptoms: ['Se apaga al frenar', 'RPM locas'],
                causes: ['IAC sucia', 'Cuerpo aceleración sucio', 'Fugas'], solutions: ['Limpiar cuerpo aceleración', 'Calibrar IAC']
            },
            'P06': { 
                sys: 'ECU y Salidas', symptoms: ['No arranca', 'Tablero falla'],
                causes: ['Batería baja', 'Tierras mal', 'ECU daño'], solutions: ['Cargar batería', 'Limpiar tierras', 'Revisar fusibles']
            },
            'P07': { 
                sys: 'Transmisión Auto', symptoms: ['Golpes al cambiar', 'No cambia'],
                causes: ['Nivel aceite bajo', 'Solenoide mal', 'Aceite viejo'], solutions: ['Nivel ATF', 'Cambiar aceite', 'Revisar solenoides']
            },
            'B': { sys: 'Carrocería', symptoms: ['Fallo eléctrico', 'Airbag'], causes: ['Fusible', 'Cable cortado'], solutions: ['Revisar fusibles', 'Escanear BCM'] },
            'C': { sys: 'Chasis/ABS', symptoms: ['Luz ABS', 'Dirección dura'], causes: ['Sensor rueda', 'Módulo ABS'], solutions: ['Limpiar sensores', 'Purgar frenos'] },
            'U': { sys: 'Red Comunicación', symptoms: ['No arranca', 'Fallo general'], causes: ['Módulo off', 'Cable CAN roto'], solutions: ['Batería 100%', 'Revisar red CAN'] }
        };

        // --- BASE DE DATOS COMPLETA RESTAURADA ---
        const rawCodesList = [
            {c:"P0001",t:"Regulador Volumen Combustible",d:"Circuito abierto en regulador.",s:"high"},
            {c:"P0010",t:"Actuador Árbol Levas A (B1)",d:"Fallo circuito solenoide VVT.",s:"high"}, 
            {c:"P0011",t:"Árbol Levas A Muy Avanzado",d:"Sincronización adelantada.",s:"high"},
            {c:"P0012",t:"Árbol Levas A Muy Retrasado",d:"Sincronización atrasada.",s:"high"},
            {c:"P0016",t:"Correlación Cigüeñal/Levas",d:"Motor fuera de tiempo.",s:"critical"}, 
            {c:"P0030",t:"Calentador O2 (B1 S1)",d:"Fallo resistencia lambda.",s:"medium"},
            {c:"P0087",t:"Presión Riel Baja",d:"Bomba alta o sensor.",s:"critical"}, 
            {c:"P0088",t:"Presión Riel Alta",d:"Regulador bloqueado.",s:"critical"},
            {c:"P0093",t:"Fuga Grande Combustible",d:"Caída presión masiva.",s:"critical"},
            {c:"P0101",t:"Rango MAF",d:"Lectura aire mal.",s:"medium"}, 
            {c:"P0102",t:"Entrada Baja MAF",d:"Fuga aire o sensor muerto.",s:"medium"},
            {c:"P0106",t:"Rango MAP",d:"Vacío incorrecto.",s:"medium"},
            {c:"P0113",t:"Entrada Alta IAT",d:"Sensor aire desconectado.",s:"low"}, 
            {c:"P0118",t:"Entrada Alta ECT",d:"Sensor refrigerante desconectado.",s:"high"},
            {c:"P0121",t:"Rango TPS A",d:"Pista acelerador sucia.",s:"high"}, 
            {c:"P0128",t:"Termostato Refrigerante",d:"Motor no calienta.",s:"low"},
            {c:"P0135",t:"Calentador O2 (B1 S1)",d:"Resistencia rota.",s:"medium"}, 
            {c:"P0171",t:"Sistema Pobre (B1)",d:"Falta gasolina/Aire extra.",s:"high"}, 
            {c:"P0172",t:"Sistema Rico (B1)",d:"Sobra gasolina.",s:"high"}, 
            {c:"P0193",t:"Entrada Alta FRP",d:"Sensor presión riel (Corto).",s:"critical"},
            {c:"P0200",t:"Circuito Inyectores",d:"Fallo driver.",s:"critical"}, 
            {c:"P0201",t:"Fallo Inyector 1",d:"Circuito abierto/corto.",s:"critical"},
            {c:"P0202",t:"Fallo Inyector 2",d:"Circuito abierto/corto.",s:"critical"},
            {c:"P0203",t:"Fallo Inyector 3",d:"Circuito abierto/corto.",s:"critical"},
            {c:"P0204",t:"Fallo Inyector 4",d:"Circuito abierto/corto.",s:"critical"},
            {c:"P0234",t:"Overboost Turbo",d:"Presión excesiva.",s:"critical"}, 
            {c:"P0299",t:"Underboost Turbo",d:"Baja presión (Fuga).",s:"high"},
            {c:"P0300",t:"Misfire Aleatorio",d:"Fallo múltiples cilindros.",s:"critical"}, 
            {c:"P0301",t:"Misfire Cilindro 1",d:"Fallo cilindro 1.",s:"critical"}, 
            {c:"P0302",t:"Misfire Cilindro 2",d:"Fallo cilindro 2.",s:"critical"}, 
            {c:"P0303",t:"Misfire Cilindro 3",d:"Fallo cilindro 3.",s:"critical"}, 
            {c:"P0304",t:"Misfire Cilindro 4",d:"Fallo cilindro 4.",s:"critical"}, 
            {c:"P0322",t:"Sin Señal CKP",d:"Motor se apaga.",s:"critical"}, 
            {c:"P0335",t:"Circuito CKP",d:"Fallo sensor cigüeñal.",s:"critical"}, 
            {c:"P0340",t:"Circuito CMP",d:"Fallo árbol levas.",s:"high"}, 
            {c:"P0401",t:"Flujo Bajo EGR",d:"EGR tapada.",s:"medium"}, 
            {c:"P0420",t:"Eficiencia Catalizador",d:"Catalizador mal.",s:"low"}, 
            {c:"P0442",t:"Fuga Pequeña EVAP",d:"Tapón gasolina.",s:"low"}, 
            {c:"P0455",t:"Fuga Grande EVAP",d:"Fuga masiva vapores.",s:"medium"}, 
            {c:"P0500",t:"Sensor VSS",d:"Sin señal velocidad.",s:"medium"}, 
            {c:"P0505",t:"Control Ralentí",d:"Válvula IAC mal.",s:"medium"}, 
            {c:"P0606",t:"Fallo Procesador",d:"ECU dañada.",s:"critical"}, 
            {c:"P0700",t:"Control Transmisión",d:"Fallo caja auto.",s:"high"}, 
            {c:"U0001",t:"Bus CAN High",d:"Red caída.",s:"critical"}, 
            {c:"U0100",t:"Pérdida Com. ECM",d:"Sin conexión motor.",s:"critical"}, 
            {c:"B1000",t:"Fallo ECU Body",d:"Error BCM.",s:"high"}, 
            {c:"C0035",t:"Vel. Rueda Izq",d:"Sensor ABS rueda izq.",s:"high"}
        ];
        
        // Esta es la lista masiva extraída anteriormente
        const extraCodesString = "P0002 P0003 P0004 P0008 P0009 P0013 P0014 P0015 P0017 P0018 P0019 P0020 P0021 P0022 P0023 P0024 P0025 P0026 P0027 P0029 P0031 P0032 P0033 P0034 P0035 P0036 P0037 P0038 P0039 P0040 P0041 P0042 P0043 P0044 P0045 P0046 P0047 P0048 P0049 P0050 P0051 P0053 P0054 P0056 P0057 P0060 P0064 P0068 P0069 P0070 P0071 P0072 P0073 P0075 P0076 P0077 P0078 P0079 P0080 P0082 P0089 P0090 P0091 P0092 P0094 P0095 P0096 P0097 P0098 P0100 P0103 P0104 P0105 P0107 P0108 P0109 P0110 P0111 P0112 P0114 P0115 P0116 P0117 P0119 P0120 P0122 P0123 P0125 P0130 P0131 P0132 P0133 P0134 P0136 P0137 P0138 P0139 P0140 P0141 P0142 P0143 P0150 P0151 P0152 P0153 P0154 P0155 P0156 P0157 P0158 P0159 P0160 P0161 P0173 P0174 P0175 P0180 P0181 P0182 P0183 P0185 P0190 P0191 P0192 P0194 P0196 P0197 P0198 P0205 P0206 P0209 P0215 P0216 P0217 P0219 P0220 P0221 P0222 P0223 P0225 P0226 P0228 P0229 P0230 P0231 P0232 P0235 P0236 P0237 P0238 P0240 P0241 P0243 P0244 P0245 P0246 P0248 P0251 P0252 P0253 P0256 P0261 P0262 P0263 P0264 P0265 P0266 P0267 P0268 P0269 P0270 P0271 P0272 P0290 P0305 P0306 P0307 P0308 P0315 P0316 P0320 P0321 P0325 P0326 P0327 P0328 P0330 P0332 P0333 P0336 P0337 P0338 P0339 P0341 P0342 P0343 P0344 P0345 P0350 P0351 P0352 P0353 P0354 P0355 P0356 P0358 P0365 P0370 P0373 P0380 P0381 P0400 P0402 P0403 P0404 P0405 P0406 P0407 P0408 P0410 P0411 P0412 P0413 P0414 P0418 P0421 P0422 P0423 P0426 P0427 P0428 P0430 P0431 P0432 P0440 P0441 P0443 P0444 P0445 P0446 P0447 P0448 P0449 P0450 P0451 P0452 P0453 P0456 P0460 P0461 P0462 P0463 P0470 P0471 P0472 P0473 P0474 P0475 P0480 P0481 P0482 P0483 P0485 P0496 P0501 P0502 P0503 P0504 P0506 P0507 P0520 P0521 P0522 P0523 P0530 P0532 P0533 P0550 P0551 P0560 P0561 P0562 P0563 P0568 P0571 P0573 P0578 P0579 P0597 P0600 P0601 P0602 P0603 P0604 P0605 P0607 P0620 P0621 P0622 P0638 P0641 P0650 P0670 P0683 P0685 P0701 P0702 P0703 P0704 P0705 P0706 P0707 P0708 P0710 P0711 P0713 P0715 P0716 P0717 P0720 P0721 P0722 P0723 P0725 P0726 P0727 P0730 P0731 P0732 P0733 P0734 P0735 P0736 P0740 P0741 P0743 P0744 P0745 P0746 P0748 P0750 P0751 P0753 P0755 P0758 P0760 P0761 P0766 P0768 P0771 P0773 P0776 P0778 P0780 P0781 P0783 P1100 P1101 P1102 P1103 P1106 P1110 P1111 P1112 P1113 P1114 P1116 P1121 P1122 P1125 P1127 P1128 P1130 P1131 P1135 P1137 P1138 P1141 P1142 P1144 P1152 P1155 P1156 P1158 P1168 P1169 P1176 P1178 P1180 P1181 P1186 P1187 P1188 P1189 P1190 P1191 P1196 P1198 P1199 P1200 P1201 P1211 P1212 P1220 P1229 P1230 P1248 P1256 P1260 P1292 P1293 P1296 P1297 P1299 P1300 P1301 P1302 P1316 P1336 P1340 P1345 P1349 P1350 P1351 P1352 P1361 P1400 P1401 P1402 P1403 P1404 P1405 P1407 P1408 P1423 P1434 P1435 P1440 P1442 P1444 P1445 P1446 P1450 P1453 P1467 P1470 P1479 P1480 P1481 P1482 P1495 P1500 P1501 P1503 P1504 P1505 P1507 P1515 P1517 P1519 P1520 P1523 P1524 P1525 P1531 P1539 P1540 P1549 P1565 P1566 P1571 P1573 P1577 P1579 P1585 P1586 P1600 P1601 P1602 P1603 P1604 P1605 P1606 P1607 P1609 P1612 P1613 P1614 P1615 P1616 P1624 P1626 P1632 P1635 P1639 P1641 P1642 P1643 P1650 P1652 P1653 P1654 P1662 P1689 P1690 P1693 P1700 P1701 P1728 P1731 P1732 P1735 P1736 P1740 P1743 P1745 P1793 P1800 P1847 P1850 P1856 P1857 P1861 P1876 P1900 P1901 P1906 P1911 P1912 P2002 P2135 P2138 P2237 P2463 U0026 U0073 U0101 U0109 U0121 U0126 U0140 U0155 U0401 U1000 U1001 U1003 U1017 U1023 U1061 U1073 U1080 U1101 U1105 U1111 U1113 U1121 U1123 U1200 U1205 U1206 U1208 U1218 U1750 U1900 U2000 U2002 U2013 U2019 U2500 U3000 B1201 B1210 B1211 B1220 B1232 B1266 B1267 B1300 B1301 B1325 B1346 B1402 B1410 B1412 B1421 B1484 B1485 B1500 B1505 B1519 B1520 B1620 B1650 B1800 B1806 B1808 B1811 B1826 B1868 B1900 B2100 B2200 B2203 B2477 B2500 B2501 B2600 C1095 C1100 C1101 C1102 C1110 C1111 C1112 C1116 C1127 C1132 C1140 C1141 C1161 C1170 C1172 C1200 C1201 C1207 C1210 C1220 C1221 C1233 C1237 C1241 C1260 C1261 C1500 C1800 C1860";

        // Generar Datos
        function generateData() {
            const extra = extraCodesString.split(' ').map(c => ({c, t:`Código ${c}`, d:"Fallo registrado en sistema.", s:"medium"}));
            const all = [...rawCodesList, ...extra];
            const unique = new Map(all.map(i => [i.c, i]));
            
            return Array.from(unique.values()).map(item => {
                let prefix = item.c.substring(0,3);
                let kb = knowledgeBase[prefix] || knowledgeBase[item.c.substring(0,1)] || {sys:'General', symptoms:['Check Engine'], causes:['Genérico'], solutions:['Ver manual']};
                return { ...item, sysName: kb.sys, symptoms: kb.symptoms, causes: kb.causes, solutions: kb.solutions };
            });
        }
        
        const obdCodes = generateData();

        // --- LÓGICA DE UI ---
        const resultsEl = document.getElementById('resultsContainer');
        const searchInput = document.getElementById('searchInput');
        let currentFilter = 'all';
        let isCompact = false;
        let recentCodes = JSON.parse(localStorage.getItem('obd_history') || '[]');

        function init() {
            obdCodes.sort((a,b) => {
                const numA = parseInt(a.c.replace(/\D/g, '')) || 0;
                const numB = parseInt(b.c.replace(/\D/g, '')) || 0;
                if(a.c[0] !== b.c[0]) return a.c.localeCompare(b.c);
                return numA - numB;
            });

            document.getElementById('totalCount').textContent = obdCodes.length;
            
            // Check Theme
            if (localStorage.getItem('theme') === 'light') document.documentElement.classList.remove('dark');
            
            updateHistoryUI();
            filterCodes();
        }

        // Render Cards
        function createCard(item) {
            const colors = {
                critical: 'text-red-500 border-red-500 bg-red-500/10',
                high: 'text-orange-500 border-orange-500 bg-orange-500/10',
                medium: 'text-yellow-500 border-yellow-500 bg-yellow-500/10',
                low: 'text-blue-500 border-blue-500 bg-blue-500/10'
            }[item.s];

            return `
            <div class="glass-panel rounded-xl overflow-hidden code-card flex flex-col h-full border-t-4 ${colors.split(' ')[1]}">
                <div class="card-header p-5 border-b border-gray-200 dark:border-slate-700/50 bg-gray-50 dark:bg-slate-800/30 flex justify-between items-start relative">
                    <div>
                        <span class="inline-block px-2 py-0.5 rounded text-[10px] font-bold uppercase ${colors} border border-opacity-20 mb-2">${item.s}</span>
                        <h2 class="text-3xl font-mono font-bold text-slate-800 dark:text-white card-title-lg">${item.c}</h2>
                        <p class="text-xs text-blue-600 dark:text-blue-400 font-bold uppercase">${item.sysName}</p>
                    </div>
                    <div class="text-4xl opacity-5 dark:text-white dark:opacity-10 absolute top-4 right-4 font-mono select-none">${item.c.charAt(0)}</div>
                </div>
                
                <div class="card-body p-5 flex-grow flex flex-col gap-3">
                    <div class="card-details">
                        <h3 class="text-lg font-bold text-slate-700 dark:text-slate-100 leading-tight mb-2">${item.t}</h3>
                        <p class="text-sm text-slate-500 dark:text-slate-400 card-desc">${item.d}</p>
                    </div>
                    
                    ${!isCompact ? `
                    <div class="space-y-2 mt-auto pt-2 text-sm card-details">
                        <div class="bg-gray-100 dark:bg-slate-900/50 p-2 rounded border border-gray-200 dark:border-slate-700">
                            <strong class="text-rose-500 text-xs uppercase block mb-1">Causas Probables</strong>
                            <p class="text-slate-600 dark:text-slate-400 truncate">${item.causes.join(', ')}</p>
                        </div>
                        <div class="bg-gray-100 dark:bg-slate-900/50 p-2 rounded border border-gray-200 dark:border-slate-700">
                            <strong class="text-emerald-600 dark:text-emerald-500 text-xs uppercase block mb-1">Solución</strong>
                            <p class="text-slate-600 dark:text-slate-300">${item.solutions[0]}</p>
                        </div>
                    </div>
                    ` : ''}

                    <div class="card-actions flex gap-2 mt-auto pt-3 border-t border-gray-200 dark:border-slate-700/50">
                        <button onclick="addToHistory('${item.c}'); window.open('https://www.youtube.com/results?search_query=solucionar+codigo+${item.c}', '_blank')" class="flex-1 py-2 rounded bg-red-600 hover:bg-red-700 text-white text-xs font-bold transition-colors" title="Ver en YouTube">
                            <i class="fa-brands fa-youtube text-lg"></i>
                        </button>
                        <button onclick="addToHistory('${item.c}'); window.open('https://www.google.com/search?q=repuesto+para+codigo+${item.c}&tbm=shop', '_blank')" class="flex-1 py-2 rounded bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold transition-colors" title="Buscar Pieza">
                            <i class="fa-brands fa-google text-lg"></i>
                        </button>
                        <button onclick="addToHistory('${item.c}'); copyToClipboard('${item.c}: ${item.t}')" class="flex-1 py-2 rounded bg-gray-200 dark:bg-slate-700 hover:bg-gray-300 dark:hover:bg-slate-600 text-slate-600 dark:text-slate-300 text-xs font-bold transition-colors" title="Copiar">
                            <i class="fa-solid fa-copy text-lg"></i>
                        </button>
                    </div>
                </div>
            </div>`;
        }

        // Functions
        function filterCodes() {
            const q = searchInput.value.toLowerCase().replace(/\s/g,'');
            const filtered = obdCodes.filter(i => {
                const sys = i.c.charAt(0);
                return (currentFilter === 'all' || sys === currentFilter) && 
                       (i.c.toLowerCase().includes(q) || i.t.toLowerCase().includes(q));
            });
            
            document.getElementById('visibleCount').textContent = filtered.length;
            
            if(filtered.length === 0) {
                document.getElementById('noResults').classList.remove('hidden');
                resultsEl.innerHTML = '';
            } else {
                document.getElementById('noResults').classList.add('hidden');
                const limit = (q === '' && currentFilter === 'all') ? 40 : 100;
                resultsEl.innerHTML = filtered.slice(0, limit).map(createCard).join('');
                
                // Botón cargar más si hay muchos resultados
                if(filtered.length > limit) {
                    const more = document.createElement('div');
                    more.className = 'col-span-full text-center py-4';
                    more.innerHTML = `<button onclick="renderAll()" class="text-blue-500 hover:underline">Ver todos los resultados (${filtered.length})</button>`;
                    resultsEl.appendChild(more);
                    window.renderAll = () => { resultsEl.innerHTML = filtered.map(createCard).join(''); };
                }
            }
            
            document.getElementById('clearSearch').classList.toggle('hidden', q.length === 0);
        }

        // Features
        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
        }

        function toggleView() {
            isCompact = !isCompact;
            document.getElementById('viewIcon').className = isCompact ? 'fa-solid fa-table-cells-large' : 'fa-solid fa-list';
            document.body.classList.toggle('view-compact', isCompact);
            filterCodes();
        }

        function toggleHistory() {
            document.getElementById('historyPanel').classList.toggle('hidden');
        }

        function addToHistory(code) {
            if(!recentCodes.includes(code)) {
                recentCodes.unshift(code);
                if(recentCodes.length > 10) recentCodes.pop();
                localStorage.setItem('obd_history', JSON.stringify(recentCodes));
                updateHistoryUI();
            }
        }

        function updateHistoryUI() {
            const list = document.getElementById('historyList');
            if(recentCodes.length === 0) {
                list.innerHTML = '<p class="text-sm text-slate-500 italic">Sin historial reciente.</p>';
                document.getElementById('historyBadge').classList.add('hidden');
            } else {
                document.getElementById('historyBadge').classList.remove('hidden');
                list.innerHTML = recentCodes.map(c => 
                    `<button onclick="searchInput.value='${c}'; filterCodes(); toggleHistory()" class="px-3 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-700 rounded text-xs font-mono font-bold hover:border-blue-500 text-slate-700 dark:text-slate-300">${c}</button>`
                ).join('');
            }
        }

        function clearHistory() {
            recentCodes = [];
            localStorage.removeItem('obd_history');
            updateHistoryUI();
        }
        
        function resetSearch() {
            searchInput.value = '';
            currentFilter = 'all';
            document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('[data-filter="all"]').classList.add('active');
            filterCodes();
        }

        // Event Listeners
        searchInput.addEventListener('input', () => setTimeout(filterCodes, 150));
        document.getElementById('clearSearch').addEventListener('click', () => { searchInput.value=''; filterCodes(); });
        
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter;
                filterCodes();
            });
        });

        window.copyToClipboard = (text) => {
            navigator.clipboard.writeText(text);
            alert("Copiado: " + text); 
        }

        // Init
        init();
    </script>
</body>
</html>
